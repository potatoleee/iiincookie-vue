import{M as y}from"./bootstrap-1e9f360c.js";import{b as D}from"./@ckeditor-34cd5b3f.js";import{U as L}from"./UploadImages-0f10d8f0.js";import{T as h}from"./toast-94376381.js";import{aN as m,aD as c,X as d,Y as e,a4 as a,bk as x,as as u,bm as w,bd as U,b9 as E,a_ as b,F as P,aL as I}from"./@vue-9b9f1f8d.js";import{_ as k}from"./index-f2d211fb.js";import{D as $,P as C}from"./PaginationComponent-6e071429.js";import"./@popperjs-9847b28c.js";import"./vue-d45f05e8.js";import"./sweetalert2-761b07dd.js";import"./pinia-a78a79b1.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-fe912644.js";import"./axios-bff3f665.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-89c4fdf0.js";import"./vee-validate-aa5cd44a.js";import"./@vee-validate-533577de.js";/* empty css                        */import"./gsap-8fc7659c.js";const{VITE_APP_URL:V,VITE_APP_PATH:M}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},N={props:["isNew","innerTempArticle"],data(){return{tempArticle:{},articleModal:"",create_at:0,content:"",editor:D,editorConfig:{toolbar:["heading","|","bold","italic","|","link","bulletedList","numberedList","|","undo","redo"]}}},methods:{confirm(){let l="post",t=`${V}/api/${M}/admin/article`;this.isNew===!1&&(l="put",t=`${V}/api/${M}/admin/article/${this.tempArticle.id}`),this.$http[l](t,{data:this.tempArticle}).then(r=>{h.fire({icon:"success",title:`${r.data.message}`}),this.articleModal.hide(),this.$emit("update")}).catch(r=>{h.fire({icon:"error",title:`${r.response.data.message}`})})},show(){this.articleModal.show()},hide(){this.articleModal.hide()}},watch:{innerTempArticle(){this.tempArticle=this.innerTempArticle;const l=new Date(this.tempArticle.create_at*1e3).toISOString().split("T");this.create_at=l[0]},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},mounted(){this.articleModal=new y(this.$refs.articleModal)},components:{UploadImages:L}},R={id:"articleModal",class:"modal fade",tabindex:"-1","aria-labelledby":"articleModalabel","aria-hidden":"true",ref:"articleModal"},S={class:"modal-dialog modal-xl"},F={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},B={id:"articleModalLabel",class:"modal-title"},H={key:0},O={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},X={class:"row"},Y={class:"mb-3 col-md-12"},j=e("label",{for:"article_image",class:"form-label"},"文章圖片網址",-1),J=["src","alt"],K={class:"row"},Q={class:"mb-3 col-md-12"},W=e("label",{for:"article_title",class:"form-label"},"文章標題",-1),Z={class:"row"},ee={class:"mb-3 col-md-12"},te=e("label",{for:"article_create_at",class:"form-label"},"創立時間",-1),ie={class:"row"},le={class:"mb-3 col-md-12"},se=e("label",{for:"article_author",class:"form-label"},"文章作者",-1),oe={class:"row"},ae={class:"mb-3 col-md-12"},ne=e("label",{for:"article_content",class:"form-label"},"文章內容",-1),re={class:"w-100"},ce={class:"row"},de={class:"mb-3 col-md-12"},me=e("label",{for:"article_tag",class:"form-label"},"文章標籤",-1),pe={class:"form-check"},_e={class:"form-check-label",for:"isPublic"},he={class:"modal-footer"},ue={type:"submit",class:"btn btn-primary text-light"};function be(l,t,r,T,i,n){const f=m("UploadImages"),p=m("VField"),_=m("ErrorMessage"),A=m("VForm");return c(),d("div",R,[e("div",S,[e("div",F,[e("div",q,[e("h5",B,[r.isNew?(c(),d("span",H,"新增文章")):(c(),d("span",O,"編輯文章"))]),G]),a(A,{ref:"form",onSubmit:n.confirm},{default:x(({errors:o})=>[e("div",z,[a(f),e("div",X,[e("div",Y,[j,a(p,{id:"article_image",type:"text",class:u(["form-control",{"is-invalid":o.圖片網址}]),name:"圖片網址",rules:"required",placeholder:"請輸入文章圖片網址",modelValue:i.tempArticle.image,"onUpdate:modelValue":t[0]||(t[0]=s=>i.tempArticle.image=s)},null,8,["class","modelValue"]),a(_,{name:"圖片網址",class:"invalid-feedback"})]),e("img",{class:"img-fluid",src:i.tempArticle.image,alt:i.tempArticle.title},null,8,J)]),e("div",K,[e("div",Q,[W,a(p,{id:"article_title",type:"text",class:u(["form-control",{"is-invalid":o.文章標題}]),name:"文章標題",rules:"required",placeholder:"請輸入文章標題",modelValue:i.tempArticle.title,"onUpdate:modelValue":t[1]||(t[1]=s=>i.tempArticle.title=s)},null,8,["class","modelValue"]),a(_,{name:"文章標題",class:"invalid-feedback"})])]),e("div",Z,[e("div",ee,[te,w(e("input",{id:"article_create_at",type:"date",class:"form-control",placeholder:"請輸入文章標題","onUpdate:modelValue":t[2]||(t[2]=s=>i.create_at=s)},null,512),[[U,i.create_at]])])]),e("div",ie,[e("div",le,[se,a(p,{id:"article_author",type:"text",class:u(["form-control",{"is-invalid":o.文章作者}]),name:"文章作者",rules:"required",placeholder:"請輸入文章作者",modelValue:i.tempArticle.author,"onUpdate:modelValue":t[3]||(t[3]=s=>i.tempArticle.author=s)},null,8,["class","modelValue"]),a(_,{name:"文章作者",class:"invalid-feedback"})])]),e("div",oe,[e("div",ae,[ne,e("div",re,[a(p,{name:"文章內容",rules:"required",class:u({"is-invalid":o.文章內容}),editor:i.editor,modelValue:i.tempArticle.content,"onUpdate:modelValue":t[4]||(t[4]=s=>i.tempArticle.content=s),config:i.editorConfig,as:"ckeditor"},null,8,["class","editor","modelValue","config"]),a(_,{name:"文章內容",class:"invalid-feedback"})])])]),e("div",ce,[e("div",de,[me,a(p,{id:"article_tag",type:"text",class:u(["form-control",{"is-invalid":o.文章標籤}]),name:"文章標籤",rules:"required",placeholder:"請輸入文章標籤",modelValue:i.tempArticle.tag,"onUpdate:modelValue":t[5]||(t[5]=s=>i.tempArticle.tag=s)},null,8,["class","modelValue"]),a(_,{name:"文章標籤",class:"invalid-feedback"})])]),e("div",pe,[w(e("input",{id:"isPublic",class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>i.tempArticle.isPublic=s),"true-value":!0,"false-value":!1},null,512),[[E,i.tempArticle.isPublic]]),e("label",_e,b(i.tempArticle.isPublic?"啟用":"不啟用"),1)])]),e("div",he,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...s)=>n.hide&&n.hide(...s))}," 取消 "),e("button",ue,b(this.isNew?"新增文章":"更新文章"),1)])]),_:1},8,["onSubmit"])])])],512)}const fe=k(N,[["render",be]]),{VITE_APP_URL:g,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},Ae={data(){return{articles:[],sortedArticles:[],pagination:{},isNew:!1,tempArticle:{},isLoading:!1}},methods:{openModal(l,t){l==="new"?(this.tempArticle={create_at:new Date().getTime()/1e3,isPublic:!0,tag:[],content:""},this.$refs.articleModal.show(),this.isNew=!0):l==="edit"?(this.$refs.articleModal.show(),this.tempArticle={...t},this.isNew=!1):l==="delete"&&(this.$refs.deleteModal.show(),this.tempArticle={...t},this.isNew=!1)},getArticleList(l=1){this.isLoading=!0,this.$http.get(`${g}/api/${v}/admin/articles/?page=${l}`).then(t=>{this.isLoading=!1,this.pagination=t.data.pagination,this.articles=t.data.articles}).catch(t=>{h.fire({icon:"error",title:`${t.response.data.message}`})})},openArticle(l){this.$http.get(`${g}/api/${v}/admin/article/${l.id}`).then(t=>{this.tempArticle=t.data.article,this.$refs.articleModal.show()}).catch(t=>{h.fire({icon:"error",title:`${t.response.data.message}`})})},formatDate(l){return new Date(l*1e3).toLocaleDateString()},deleteArticle(){this.$http.delete(`${g}/api/${v}/admin/article/${this.tempArticle.id}`).then(l=>{h.fire({icon:"success",title:`${l.data.message}`}),this.$refs.deleteModal.hide(),this.getArticleList()}).catch(l=>{h.fire({icon:"error",title:`${l.response.data.message}`})})}},watch:{articles:{handler(l){this.sortedArticles=l.sort((t,r)=>new Date(r.create_at)-new Date(t.create_at))},immediate:!0}},mounted(){this.getArticleList()},components:{ArticleModal:fe,DeleteModal:$,PaginationComponent:C}},ge=e("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"文章管理",-1),ve={class:"text-end mt-4"},we={class:"table mt-4"},Pe=e("thead",null,[e("tr",null,[e("th",{width:"120"},"文章標題"),e("th",{width:"120"},"標籤"),e("th",{width:"120"},"創建日"),e("th",{width:"100"},"是否發佈"),e("th",{width:"120"},"編輯")])],-1),Ve={key:0,class:"text-success"},Me={key:1},ke={class:"btn-group"},Te=["onClick"],ye=["onClick"];function De(l,t,r,T,i,n){const f=m("VueLoading"),p=m("PaginationComponent"),_=m("ArticleModal"),A=m("DeleteModal");return c(),d(P,null,[a(f,{active:i.isLoading,"onUpdate:active":t[0]||(t[0]=o=>i.isLoading=o)},null,8,["active"]),ge,e("div",ve,[e("button",{type:"button",class:"btn btn-primary text-light",onClick:t[1]||(t[1]=o=>n.openModal("new",l.article))}," 建立新文章 ")]),e("table",we,[Pe,e("tbody",null,[(c(!0),d(P,null,I(i.sortedArticles,o=>(c(),d("tr",{key:o.id},[e("td",null,b(o.title),1),e("td",null,b(o.tag),1),e("td",null,b(n.formatDate(o.create_at)),1),e("td",null,[o.isPublic?(c(),d("span",Ve,"已啟用")):(c(),d("span",Me,"未啟用"))]),e("td",null,[e("div",ke,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:s=>n.openArticle(o)}," 編輯 ",8,Te),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:s=>n.openModal("delete",o)}," 刪除 ",8,ye)])])]))),128))])]),a(p,{"page-in":i.pagination,onGetPages:n.getArticleList},null,8,["page-in","onGetPages"]),a(_,{ref:"articleModal",innerTempArticle:i.tempArticle,isNew:i.isNew,onUpdate:n.getArticleList},null,8,["innerTempArticle","isNew","onUpdate"]),a(A,{deleteItem:i.tempArticle,deleteModalTitle:"文章",onDelItem:n.deleteArticle,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const Je=k(Ae,[["render",De]]);export{Je as default};
