import{M as y,D as $}from"./DeleteModal-593e8c2a.js";import{P as v}from"./PaginationComponent-fde7af90.js";import{_ as g,o as i,c as a,b as e,e as C,t as r,q as w,x as D,F as O,j as M,r as p,d as _}from"./index-66d68702.js";import{S as P}from"./sweetalert2.all-3fb583b0.js";const x={props:{innerTempOrder:{type:Object,default(){return{}}}},data(){return{orderModal:"",tempOrder:{}}},methods:{orderConfirm(){this.$emit("orderConfirm",this.tempOrder)},show(){this.orderModal.show()},hide(){this.orderModal.hide()}},watch:{innerTempOrder(){this.tempOrder=this.innerTempOrder}},mounted(){this.orderModal=new y(this.$refs.orderModal)}},T={id:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"orderModal"},L={class:"modal-dialog modal-xl"},A={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"編輯訂單")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),V={class:"modal-body"},E=e("p",null,"訂單資訊",-1),N={class:"form-check"},B={class:"form-check-label",for:"is_paid"},S=e("h3",null,"客戶資訊",-1),R=e("h3",null,"訂單品項",-1),U={class:"table"},j=e("thead",null,[e("tr",null,[e("th",null,"品項"),e("th",null,"單價"),e("th",null,"數量"),e("th",null,"小計")])],-1),q={class:"text-end"},F={class:"modal-footer"};function G(o,t,u,k,s,n){var c,h,m,l;return i(),a("div",T,[e("div",L,[e("div",A,[I,e("div",V,[E,C(" "+r(s.tempOrder.id)+" ",1),e("div",N,[w(e("input",{id:"is_paid",class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=d=>s.tempOrder.is_paid=d),"true-value":!0,"false-value":!1},null,512),[[D,s.tempOrder.is_paid]]),e("label",B,r(s.tempOrder.is_paid?"已付款":"未付款"),1)]),S,e("ul",null,[e("li",null,"客戶姓名："+r((c=s.tempOrder.user)==null?void 0:c.name),1),e("li",null,"聯絡電話："+r((h=s.tempOrder.user)==null?void 0:h.tel),1),e("li",null,"電子信箱："+r((m=s.tempOrder.user)==null?void 0:m.email),1),e("li",null,"寄送地址："+r((l=s.tempOrder.user)==null?void 0:l.address),1),e("li",null,"備註："+r(s.tempOrder.message),1)]),R,e("div",null,[e("table",U,[j,e("tbody",null,[(i(!0),a(O,null,M(s.tempOrder.products,d=>(i(),a("tr",{key:d.products},[e("td",null,r(d.product.title),1),e("td",null,"NT$ "+r(d.product.price),1),e("td",null,r(d.qty),1),e("td",null,"NT$ "+r(d.total),1)]))),128))])])]),e("div",q,[e("p",null,"總計：NT$ "+r(s.tempOrder.total),1)])]),e("div",F,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[1]||(t[1]=(...d)=>n.hide&&n.hide(...d))}," 取消 "),e("button",{type:"button",class:"btn btn-primary",onClick:t[2]||(t[2]=(...d)=>n.orderConfirm&&n.orderConfirm(...d))}," 確認 ")])])])],512)}const H=g(x,[["render",G]]),{VITE_APP_URL:b,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},z={data(){return{pagination:{},orderData:[],tempOrder:{}}},methods:{getOrderList(o=1){this.$http.get(`${b}/api/${f}/admin/orders/?page=${o}`).then(t=>{console.log(t.data),this.orderData=t.data.orders,this.pagination=t.data.pagination,console.log(this.orderData)}).catch(t=>{alert(t.response.data.message)})},formatDate(o){return new Date(o*1e3).toLocaleString()},openModal(o,t){o==="edit"?(this.$refs.orderModal.show(),this.tempOrder={...t}):o==="delete"&&(this.$refs.deleteModal.show(),this.tempOrder={...t})},deleteOrder(){this.$http.delete(`${b}/api/${f}/admin/order/${this.tempOrder.id}`).then(o=>{alert(o.data.message),this.$refs.deleteModal.hide(),this.getOrderList()}).catch(o=>{alert(o.response.data.message)})},editOrderModal(o){const t={is_paid:o.is_paid};this.$http.put(`${b}/api/${f}/admin/order/${o.id}`,{data:t}).then(()=>{P.fire({position:"top-end",icon:"success",title:"已訂單資訊",showConfirmButton:!1,timer:800}),this.$refs.orderModal.hide(),this.getOrderList()}).catch(u=>{alert(u.response.data.message)})}},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o,this.getOrderList()},components:{PaginationComponent:v,DeleteModal:$,OrderModal:H}},J=e("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"訂單管理",-1),K={class:"table mt-4"},Q=e("thead",null,[e("tr",null,[e("th",{width:"120"},"訂單日期"),e("th",{width:"120"},"訂單編號"),e("th",{width:"120"},"聯絡人"),e("th",{width:"120"},"金額"),e("th",{width:"100"},"付款狀態"),e("th",{width:"120"},"編輯")])],-1),W={key:0,class:"text-success"},X={key:1},Y={class:"btn-group"},Z=["onClick"],ee=["onClick"];function te(o,t,u,k,s,n){const c=p("PaginationComponent"),h=p("OrderModal"),m=p("DeleteModal");return i(),a(O,null,[J,e("table",K,[Q,e("tbody",null,[(i(!0),a(O,null,M(s.orderData,l=>(i(),a("tr",{key:l.id},[e("td",null,r(n.formatDate(l.create_at)),1),e("td",null,r(l.id),1),e("td",null,r(l.user.name)+" "+r(l.user.email),1),e("td",null,"NT$"+r(l.total),1),e("td",null,[l.is_paid?(i(),a("span",W,"已付款")):(i(),a("span",X,"未付款"))]),e("td",null,[e("div",Y,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:d=>n.openModal("edit",l)}," 編輯 ",8,Z),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:d=>n.openModal("delete",l)}," 刪除 ",8,ee)])])]))),128))])]),_(c,{"page-in":s.pagination,onGetPages:n.getOrderList},null,8,["page-in","onGetPages"]),_(h,{"inner-temp-order":s.tempOrder,onOrderConfirm:n.editOrderModal,ref:"orderModal"},null,8,["inner-temp-order","onOrderConfirm"]),_(m,{deleteItem:s.tempOrder,onDelItem:n.deleteOrder,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const le=g(z,[["render",te]]);export{le as default};
