import{M as T}from"./bootstrap-1e9f360c.js";import{b as D}from"./@ckeditor-f5fb1894.js";import{U as V}from"./UploadImages-ad900ec1.js";import{T as p}from"./toast-1797c5ef.js";import{aN as h,aD as n,X as c,Y as t,a4 as _,bm as d,bd as m,b9 as $,a_ as u,F as w,aL as U}from"./@vue-9b9f1f8d.js";import{_ as M}from"./index-c29abf88.js";import{D as x,P as E}from"./PaginationComponent-2a44b96f.js";import"./@popperjs-9847b28c.js";import"./vue-cfa7fbc0.js";import"./loadingStore-e394031f.js";import"./pinia-a78a79b1.js";import"./vue-demi-71ba0ef2.js";import"./sweetalert2-2726e422.js";import"./vue-router-fe912644.js";import"./aos-dcf01651.js";import"./axios-bff3f665.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-7a4b91db.js";import"./vee-validate-aa5cd44a.js";import"./@vee-validate-533577de.js";/* empty css                        */import"./gsap-8fc7659c.js";const{VITE_APP_URL:P,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},I={props:["isNew","innerTempArticle"],data(){return{tempArticle:{},articleModal:"",create_at:0,content:"",editor:D,editorConfig:{toolbar:["heading","|","bold","italic","|","link","bulletedList","numberedList","|","undo","redo"]}}},methods:{confirm(){let o="post",e=`${P}/api/${v}/admin/article`;this.isNew===!1&&(o="put",e=`${P}/api/${v}/admin/article/${this.tempArticle.id}`),this.$http[o](e,{data:this.tempArticle}).then(r=>{p.fire({icon:"success",title:`${r.data.message}`}),this.articleModal.hide(),this.$emit("update")}).catch(r=>{p.fire({icon:"error",title:`${r.response.data.message}`})})},show(){this.articleModal.show()},hide(){this.articleModal.hide()}},watch:{innerTempArticle(){this.tempArticle=this.innerTempArticle;const o=new Date(this.tempArticle.create_at*1e3).toISOString().split("T");this.create_at=o[0]},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},mounted(){this.articleModal=new T(this.$refs.articleModal)},components:{UploadImages:V}},L={id:"articleModal",class:"modal fade",tabindex:"-1","aria-labelledby":"articleModalabel","aria-hidden":"true",ref:"articleModal"},C={class:"modal-dialog modal-xl"},N={class:"modal-content border-0"},R={class:"modal-header bg-dark text-white"},S={id:"articleModalLabel",class:"modal-title"},B={key:0},H={key:1},O=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),F={class:"modal-body"},G={class:"row"},z={class:"mb-3 col-md-12"},X=t("label",{for:"article_image",class:"form-label"},"文章圖片網址",-1),Y=["src"],j={class:"row"},q={class:"mb-3 col-md-12"},J=t("label",{for:"article_title",class:"form-label"},"文章標題",-1),K={class:"row"},Q={class:"mb-3 col-md-12"},W=t("label",{for:"article_create_at",class:"form-label"},"創立時間",-1),Z={class:"row"},tt={class:"mb-3 col-md-12"},et=t("label",{for:"article_author",class:"form-label"},"文章作者",-1),it={class:"row"},ot={class:"mb-3 col-md-12"},st=t("label",{for:"article_description",class:"form-label"},"文章描述",-1),lt={class:"row"},rt=t("div",{class:"mb-3 col-md-12"},[t("p",null,"文章內容")],-1),at={class:"w-100"},nt={class:"row"},ct={class:"mb-3 col-md-12"},dt=t("label",{for:"article_tag",class:"form-label"},"文章標籤",-1),mt={class:"form-check"},pt={class:"form-check-label",for:"isPublic"},ht={class:"modal-footer"};function _t(o,e,r,k,i,l){const b=h("UploadImages"),f=h("ckeditor");return n(),c("div",L,[t("div",C,[t("div",N,[t("div",R,[t("h5",S,[r.isNew?(n(),c("span",B,"新增文章")):(n(),c("span",H,"編輯文章"))]),O]),t("div",F,[_(b),t("div",G,[t("div",z,[X,d(t("input",{id:"article_image",type:"text",class:"form-control",placeholder:"請輸入文章圖片網址","onUpdate:modelValue":e[0]||(e[0]=s=>i.tempArticle.image=s)},null,512),[[m,i.tempArticle.image]])]),t("img",{class:"img-fluid",src:i.tempArticle.image},null,8,Y)]),t("div",j,[t("div",q,[J,d(t("input",{id:"article_title",type:"text",class:"form-control",placeholder:"請輸入文章標題","onUpdate:modelValue":e[1]||(e[1]=s=>i.tempArticle.title=s)},null,512),[[m,i.tempArticle.title]])])]),t("div",K,[t("div",Q,[W,d(t("input",{id:"article_create_at",type:"date",class:"form-control",placeholder:"請輸入文章標題","onUpdate:modelValue":e[2]||(e[2]=s=>i.create_at=s)},null,512),[[m,i.create_at]])])]),t("div",Z,[t("div",tt,[et,d(t("input",{id:"article_author",type:"text",class:"form-control",placeholder:"請輸入文章作者","onUpdate:modelValue":e[3]||(e[3]=s=>i.tempArticle.author=s)},null,512),[[m,i.tempArticle.author]])])]),t("div",it,[t("div",ot,[st,d(t("input",{id:"article_description",type:"text",class:"form-control",placeholder:"請輸入文章標題","onUpdate:modelValue":e[4]||(e[4]=s=>i.tempArticle.description=s)},null,512),[[m,i.tempArticle.description]])])]),t("div",lt,[rt,t("div",at,[_(f,{editor:i.editor,modelValue:i.tempArticle.content,"onUpdate:modelValue":e[5]||(e[5]=s=>i.tempArticle.content=s),config:i.editorConfig},null,8,["editor","modelValue","config"])])]),t("div",nt,[t("div",ct,[dt,d(t("input",{id:"article_tag",type:"text",class:"form-control",placeholder:"請輸入文章標題","onUpdate:modelValue":e[6]||(e[6]=s=>i.tempArticle.tag=s)},null,512),[[m,i.tempArticle.tag]])])]),t("div",mt,[d(t("input",{id:"isPublic",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>i.tempArticle.isPublic=s),"true-value":!0,"false-value":!1},null,512),[[$,i.tempArticle.isPublic]]),t("label",pt,u(i.tempArticle.isPublic?"啟用":"不啟用"),1)])]),t("div",ht,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[8]||(e[8]=(...s)=>l.hide&&l.hide(...s))}," 取消 "),t("button",{type:"button",class:"btn btn-primary",onClick:e[9]||(e[9]=(...s)=>l.confirm&&l.confirm(...s))},u(this.isNew?"新增文章":"更新文章"),1)])])])],512)}const ut=M(I,[["render",_t]]),{VITE_APP_URL:A,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},bt={data(){return{articles:[],sortedArticles:[],pagination:{},isNew:!1,tempArticle:{}}},methods:{openModal(o,e){o==="new"?(this.tempArticle={create_at:new Date().getTime()/1e3,isPublic:!0,tag:[],content:""},this.$refs.articleModal.show(),this.isNew=!0):o==="edit"?(this.$refs.articleModal.show(),this.tempArticle={...e},this.isNew=!1):o==="delete"&&(this.$refs.deleteModal.show(),this.tempArticle={...e},this.isNew=!1)},getArticleList(o=1){this.$http.get(`${A}/api/${g}/admin/articles/?page=${o}`).then(e=>{this.pagination=e.data.pagination,this.articles=e.data.articles,console.log(this.articles)}).catch(e=>{p.fire({icon:"error",title:`${e.response.data.message}`})})},openArticle(o){this.$http.get(`${A}/api/${g}/admin/article/${o.id}`).then(e=>{this.tempArticle=e.data.article,this.$refs.articleModal.show()}).catch(e=>{p.fire({icon:"error",title:`${e.response.data.message}`})})},formatDate(o){return new Date(o*1e3).toLocaleDateString()},deleteArticle(){this.$http.delete(`${A}/api/${g}/admin/article/${this.tempArticle.id}`).then(o=>{p.fire({icon:"success",title:`${o.data.message}`}),this.$refs.deleteModal.hide(),this.getArticleList()}).catch(o=>{p.fire({icon:"error",title:`${o.response.data.message}`})})}},watch:{articles:{handler(o){this.sortedArticles=o.sort((e,r)=>new Date(r.create_at)-new Date(e.create_at))},immediate:!0}},mounted(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=o,this.getArticleList()},components:{ArticleModal:ut,DeleteModal:x,PaginationComponent:E}},ft=t("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"文章管理",-1),At={class:"text-end mt-4"},gt={class:"table mt-4"},wt=t("thead",null,[t("tr",null,[t("th",{width:"120"},"文章標題"),t("th",{width:"120"},"標籤"),t("th",{width:"120"},"創建日"),t("th",{width:"100"},"是否發佈"),t("th",{width:"120"},"編輯")])],-1),Pt={key:0,class:"text-success"},vt={key:1},Mt={class:"btn-group"},kt=["onClick"],yt=["onClick"];function Tt(o,e,r,k,i,l){const b=h("PaginationComponent"),f=h("ArticleModal"),s=h("DeleteModal");return n(),c(w,null,[ft,t("div",At,[t("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=a=>l.openModal("new",o.article))}," 建立新文章 ")]),t("table",gt,[wt,t("tbody",null,[(n(!0),c(w,null,U(i.sortedArticles,a=>(n(),c("tr",{key:a.id},[t("td",null,u(a.title),1),t("td",null,u(a.tag),1),t("td",null,u(l.formatDate(a.create_at)),1),t("td",null,[a.isPublic?(n(),c("span",Pt,"已啟用")):(n(),c("span",vt,"未啟用"))]),t("td",null,[t("div",Mt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>l.openArticle(a)}," 編輯 ",8,kt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>l.openModal("delete",a)}," 刪除 ",8,yt)])])]))),128))])]),_(b,{"page-in":i.pagination,onGetPages:l.getArticleList},null,8,["page-in","onGetPages"]),_(f,{ref:"articleModal",innerTempArticle:i.tempArticle,isNew:i.isNew,onUpdate:l.getArticleList},null,8,["innerTempArticle","isNew","onUpdate"]),_(s,{deleteItem:i.tempArticle,onDelItem:l.deleteArticle,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const Jt=M(bt,[["render",Tt]]);export{Jt as default};
