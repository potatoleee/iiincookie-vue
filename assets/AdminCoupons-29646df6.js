import{M as y}from"./bootstrap-1e9f360c.js";import{T as u}from"./toast-1797c5ef.js";import{aD as a,X as d,Y as e,a_ as p,bm as r,bd as m,b9 as D,aN as _,F as b,aL as $,a4 as h}from"./@vue-9b9f1f8d.js";import{_ as v}from"./index-c034beb6.js";import{D as A,P as V}from"./PaginationComponent-d2d06619.js";import"./@popperjs-9847b28c.js";import"./sweetalert2-2726e422.js";import"./@ckeditor-f5fb1894.js";import"./vue-cfa7fbc0.js";import"./pinia-a2ec2acd.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-feb1a2d6.js";import"./aos-dcf01651.js";import"./axios-bff3f665.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-7a4b91db.js";import"./vee-validate-aa5cd44a.js";import"./@vee-validate-533577de.js";/* empty css                        */import"./gsap-8fc7659c.js";const{VITE_APP_URL:f,VITE_APP_PATH:C}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},L={props:["isNew","innerTempCoupon"],data(){return{tempCoupon:{},couponsModal:"",due_date:""}},methods:{confirm(){let t="post",o=`${f}/api/${C}/admin/coupon`;this.isNew===!1&&(t="put",o=`${f}/api/${C}/admin/coupon/${this.tempCoupon.id}`),this.$http[t](o,{data:this.tempCoupon}).then(c=>{u.fire({icon:"success",title:`${c.data.message}`}),this.couponsModal.hide(),this.$emit("update")}).catch(c=>{u.fire({icon:"error",title:`${c.response.data.message}`})})},show(){this.couponsModal.show()},hide(){this.couponsModal.hide()}},watch:{innerTempCoupon(){this.tempCoupon=this.innerTempCoupon;const t=new Date(this.tempCoupon.due_date*1e3);this.due_date=t.toLocaleString(),console.log(this.due_date)},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponsModal=new y(this.$refs.couponsModal)}},E={id:"couponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponsModalLabel","aria-hidden":"true",ref:"couponsModal"},x={class:"modal-dialog"},I={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},U={id:"couponsModalLabel",class:"modal-title"},R={key:0},S={key:1},B=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},O={class:"row"},F={class:"mb-3 col-12"},G=e("label",{for:"coupon_title",class:"form-label"},"優惠券名稱",-1),z={class:"row"},X={class:"mb-3 col-12"},Y=e("label",{for:"coupon_code",class:"form-label"},"優惠券代碼",-1),j={class:"row"},q={class:"mb-3 col-12"},J=e("label",{for:"coupon_percent",class:"form-label"},"優惠折扣",-1),K={class:"row"},Q={class:"mb-3 col-12"},W=e("label",{for:"coupon_endDate",class:"form-label"},"優惠券到期日",-1),Z={class:"form-check"},ee={class:"form-check-label",for:"is_enabled"},oe={class:"modal-footer"};function te(t,o,c,M,s,i){return a(),d("div",E,[e("div",x,[e("div",I,[e("div",N,[e("h5",U,[c.isNew?(a(),d("span",R,"新增優惠券")):(a(),d("span",S,"編輯優惠券"))]),B]),e("div",H,[e("p",null,p(s.tempCoupon),1),e("div",O,[e("div",F,[G,r(e("input",{id:"coupon_title",type:"text",class:"form-control",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":o[0]||(o[0]=n=>s.tempCoupon.title=n)},null,512),[[m,s.tempCoupon.title]])])]),e("div",z,[e("div",X,[Y,r(e("input",{id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":o[1]||(o[1]=n=>s.tempCoupon.code=n)},null,512),[[m,s.tempCoupon.code]])])]),e("div",j,[e("div",q,[J,r(e("input",{id:"coupon_percent",type:"number",class:"form-control",placeholder:"請輸入優惠百分比","onUpdate:modelValue":o[2]||(o[2]=n=>s.tempCoupon.percent=n)},null,512),[[m,s.tempCoupon.percent,void 0,{number:!0}]])])]),e("div",K,[e("div",Q,[W,r(e("input",{id:"coupon_endDate",type:"datetime-local",class:"form-control",placeholder:"請選擇優惠券到期日","onUpdate:modelValue":o[3]||(o[3]=n=>s.due_date=n)},null,512),[[m,s.due_date]])])]),e("div",Z,[r(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=n=>s.tempCoupon.is_enabled=n),"true-value":1,"false-value":0},null,512),[[D,s.tempCoupon.is_enabled]]),e("label",ee,p(s.tempCoupon.is_enabled?"啟用":"不啟用"),1)])]),e("div",oe,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:o[5]||(o[5]=(...n)=>i.hide&&i.hide(...n))}," 取消 "),e("button",{type:"button",class:"btn btn-primary",onClick:o[6]||(o[6]=(...n)=>i.confirm&&i.confirm(...n))},p(this.isNew?"新增優惠券":"更新優惠券"),1)])])])],512)}const se=v(L,[["render",te]]),{VITE_APP_URL:w,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},ne={data(){return{coupons:[],pagination:{},isNew:!1,tempCoupon:{title:"",is_enabled:1,percent:100,code:""}}},methods:{openModal(t,o){t==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:1},this.$refs.couponsModal.show(),this.isNew=!0):t==="edit"?(this.$refs.couponsModal.show(),this.tempCoupon={...o},this.isNew=!1):t==="delete"&&(this.$refs.deleteModal.show(),this.tempCoupon={...o},this.isNew=!1)},getCouponList(t=1){this.$http.get(`${w}/api/${g}/admin/coupons/?page=${t}`).then(o=>{this.pagination=o.data.pagination,this.coupons=o.data.coupons}).catch(o=>{u.fire({icon:"error",title:`${o.response.data.message}`})})},formatDate(t){return new Date(t*1e3).toLocaleString()},deleteCoupon(){this.$http.delete(`${w}/api/${g}/admin/coupon/${this.tempCoupon.id}`).then(t=>{u.fire({icon:"success",title:`${t.data.message}`}),this.$refs.deleteModal.hide(),this.getCouponList()}).catch(t=>{u.fire({icon:"error",title:`${t.response.data.message}`})})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t,this.getCouponList()},components:{CouponsModal:se,DeleteModal:A,PaginationComponent:V}},ie=e("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"優惠券管理",-1),le={class:"text-end mt-4"},ae={class:"table mt-4"},de=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券標題"),e("th",{width:"120"},"優惠碼"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"啟用狀態"),e("th",{width:"120"},"編輯")])],-1),pe={key:0,class:"text-success"},ce={key:1},re={class:"btn-group"},ue=["onClick"],me=["onClick"];function _e(t,o,c,M,s,i){const n=_("PaginationComponent"),P=_("CouponsModal"),k=_("DeleteModal");return a(),d(b,null,[ie,e("div",le,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=l=>i.openModal("new",t.coupon))}," 建立新優惠券 ")]),e("table",ae,[de,e("tbody",null,[(a(!0),d(b,null,$(s.coupons,l=>(a(),d("tr",{key:l.id},[e("td",null,p(l.title),1),e("td",null,p(l.code),1),e("td",null,p(l.percent),1),e("td",null,p(i.formatDate(l.due_date)),1),e("td",null,[l.is_enabled?(a(),d("span",pe,"已啟用")):(a(),d("span",ce,"未啟用"))]),e("td",null,[e("div",re,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:T=>i.openModal("edit",l)}," 編輯 ",8,ue),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:T=>i.openModal("delete",l)}," 刪除 ",8,me)])])]))),128))])]),h(n,{"page-in":s.pagination,onGetPages:i.getCouponList},null,8,["page-in","onGetPages"]),h(P,{ref:"couponsModal",innerTempCoupon:s.tempCoupon,isNew:s.isNew,onUpdate:i.getCouponList},null,8,["innerTempCoupon","isNew","onUpdate"]),h(k,{deleteItem:s.tempCoupon,onDelItem:i.deleteCoupon,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const Ne=v(ne,[["render",_e]]);export{Ne as default};
