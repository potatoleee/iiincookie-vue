import{M as y,D as T}from"./DeleteModal-9617eefc.js";import{S as D}from"./sweetalert2.all-83f6b178.js";import{_ as g,o as a,c as d,b as e,t as p,q as c,s as r,x as A,r as m,F as _,j as V,d as h}from"./index-d0325cfd.js";import{P as $}from"./PaginationComponent-9fa72e0c.js";const{VITE_APP_URL:b,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},x={props:["isNew","innerTempCoupon"],data(){return{tempCoupon:{},couponsModal:"",due_date:""}},methods:{confirm(){let t="post",o=`${b}/api/${f}/admin/coupon`;this.isNew===!1&&(t="put",o=`${b}/api/${f}/admin/coupon/${this.tempCoupon.id}`),this.$http[t](o,{data:this.tempCoupon}).then(()=>{D.fire({position:"top-end",icon:"success",title:"已更新優惠券",showConfirmButton:!1,timer:800}),this.couponsModal.hide(),this.$emit("update")}).catch(u=>{alert(u.response.data.message)})},show(){this.couponsModal.show()},hide(){this.couponsModal.hide()}},watch:{innerTempCoupon(){this.tempCoupon=this.innerTempCoupon;const t=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.due_date=t[0]},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponsModal=new y(this.$refs.couponsModal),console.log(this.tempData)}},E={id:"couponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponsModalLabel","aria-hidden":"true",ref:"couponsModal"},L={class:"modal-dialog"},I={class:"modal-content border-0"},U={class:"modal-header bg-dark text-white"},N={id:"couponsModalLabel",class:"modal-title"},R={key:0},S={key:1},B=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},O={class:"row"},F={class:"mb-3 col-12"},G=e("label",{for:"coupon_title",class:"form-label"},"優惠券名稱",-1),j={class:"row"},q={class:"mb-3 col-12"},z=e("label",{for:"coupon_code",class:"form-label"},"優惠券代碼",-1),J={class:"row"},K={class:"mb-3 col-12"},Q=e("label",{for:"coupon_percent",class:"form-label"},"優惠折扣",-1),W={class:"row"},X={class:"mb-3 col-12"},Y=e("label",{for:"coupon_endDate",class:"form-label"},"優惠券到期日",-1),Z={class:"form-check"},ee={class:"form-check-label",for:"is_enabled"},oe={class:"modal-footer"};function te(t,o,u,v,s,l){return a(),d("div",E,[e("div",L,[e("div",I,[e("div",U,[e("h5",N,[u.isNew?(a(),d("span",R,"新增優惠券")):(a(),d("span",S,"編輯優惠券"))]),B]),e("div",H,[e("p",null,p(s.tempCoupon),1),e("div",O,[e("div",F,[G,c(e("input",{id:"coupon_title",type:"text",class:"form-control",placeholder:"請輸入優惠券名稱","onUpdate:modelValue":o[0]||(o[0]=n=>s.tempCoupon.title=n)},null,512),[[r,s.tempCoupon.title]])])]),e("div",j,[e("div",q,[z,c(e("input",{id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","onUpdate:modelValue":o[1]||(o[1]=n=>s.tempCoupon.code=n)},null,512),[[r,s.tempCoupon.code]])])]),e("div",J,[e("div",K,[Q,c(e("input",{id:"coupon_percent",type:"number",class:"form-control",placeholder:"請輸入優惠百分比","onUpdate:modelValue":o[2]||(o[2]=n=>s.tempCoupon.percent=n)},null,512),[[r,s.tempCoupon.percent,void 0,{number:!0}]])])]),e("div",W,[e("div",X,[Y,c(e("input",{id:"coupon_endDate",type:"datetime-local",class:"form-control",placeholder:"請選擇優惠券到期日","onUpdate:modelValue":o[3]||(o[3]=n=>s.due_date=n)},null,512),[[r,s.due_date]])])]),e("div",Z,[c(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=n=>s.tempCoupon.is_enabled=n),"true-value":1,"false-value":0},null,512),[[A,s.tempCoupon.is_enabled]]),e("label",ee,p(s.tempCoupon.is_enabled?"啟用":"不啟用"),1)])]),e("div",oe,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:o[5]||(o[5]=(...n)=>l.hide&&l.hide(...n))}," 取消 "),e("button",{type:"button",class:"btn btn-primary",onClick:o[6]||(o[6]=(...n)=>l.confirm&&l.confirm(...n))},p(this.isNew?"新增優惠券":"更新優惠券"),1)])])])],512)}const se=g(x,[["render",te]]),{VITE_APP_URL:C,VITE_APP_PATH:w}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},ne={data(){return{coupons:[],pagination:{},isNew:!1,tempCoupon:{title:"",is_enabled:1,percent:100,code:""}}},methods:{openModal(t,o){t==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:1},this.$refs.couponsModal.show(),this.isNew=!0):t==="edit"?(this.$refs.couponsModal.show(),this.tempCoupon={...o},this.isNew=!1):t==="delete"&&(this.$refs.deleteModal.show(),this.tempCoupon={...o},this.isNew=!1)},getCouponList(t=1){this.$http.get(`${C}/api/${w}/admin/coupons/?page=${t}`).then(o=>{console.log(o.data),this.pagination=o.data.pagination,this.coupons=o.data.coupons}).catch(o=>{alert(o.response.data.message)})},formatDate(t){return new Date(t*1e3).toLocaleString()},deleteCoupon(){this.$http.delete(`${C}/api/${w}/admin/coupon/${this.tempCoupon.id}`).then(t=>{alert(t.data.message),this.$refs.deleteModal.hide(),this.getCouponList()}).catch(t=>{alert(t.response.data.message)})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=t,this.getCouponList()},components:{CouponsModal:se,DeleteModal:T,PaginationComponent:$}},le=e("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"優惠券管理",-1),ie={class:"text-end mt-4"},ae={class:"table mt-4"},de=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券標題"),e("th",{width:"120"},"優惠碼"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"啟用狀態"),e("th",{width:"120"},"編輯")])],-1),pe={key:0,class:"text-success"},ce={key:1},ue={class:"btn-group"},re=["onClick"],me=["onClick"];function he(t,o,u,v,s,l){const n=m("PaginationComponent"),M=m("CouponsModal"),P=m("DeleteModal");return a(),d(_,null,[le,e("div",ie,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=i=>l.openModal("new",t.coupon))}," 建立新優惠券 ")]),e("table",ae,[de,e("tbody",null,[(a(!0),d(_,null,V(s.coupons,i=>(a(),d("tr",{key:i.id},[e("td",null,p(i.title),1),e("td",null,p(i.code),1),e("td",null,p(i.percent),1),e("td",null,p(l.formatDate(i.due_date)),1),e("td",null,[i.is_enabled?(a(),d("span",pe,"已啟用")):(a(),d("span",ce,"未啟用"))]),e("td",null,[e("div",ue,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:k=>l.openModal("edit",i)}," 編輯 ",8,re),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:k=>l.openModal("delete",i)}," 刪除 ",8,me)])])]))),128))])]),h(n,{"page-in":s.pagination,onGetPages:l.getCouponList},null,8,["page-in","onGetPages"]),h(M,{ref:"couponsModal",innerTempCoupon:s.tempCoupon,isNew:s.isNew,onUpdate:l.getCouponList},null,8,["innerTempCoupon","isNew","onUpdate"]),h(P,{deleteItem:s.tempCoupon,onDelItem:l.deleteCoupon,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const we=g(ne,[["render",he]]);export{we as default};
