import{M as k}from"./bootstrap-1e9f360c.js";import{T as h}from"./toast-1797c5ef.js";import{aN as u,aD as d,X as p,Y as e,a4 as a,bk as y,as as f,bm as C,bd as T,b9 as $,a_ as r,F as w,aL as x}from"./@vue-9b9f1f8d.js";import{_ as D}from"./index-45a503d2.js";import{D as E,P as A}from"./PaginationComponent-424d9463.js";import"./@popperjs-9847b28c.js";import"./sweetalert2-2726e422.js";import"./@ckeditor-f5fb1894.js";import"./vue-cfa7fbc0.js";import"./pinia-a78a79b1.js";import"./vue-demi-71ba0ef2.js";import"./vue-router-fe912644.js";import"./aos-dcf01651.js";import"./axios-bff3f665.js";import"./vue-axios-58a7c26f.js";import"./vue-loading-overlay-7a4b91db.js";import"./vee-validate-aa5cd44a.js";import"./@vee-validate-533577de.js";/* empty css                        */import"./gsap-8fc7659c.js";const{VITE_APP_URL:v,VITE_APP_PATH:g}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},L={props:["isNew","innerTempCoupon"],data(){return{tempCoupon:{},couponsModal:"",due_date:""}},methods:{confirm(){let o="post",t=`${v}/api/${g}/admin/coupon`;this.isNew===!1&&(o="put",t=`${v}/api/${g}/admin/coupon/${this.tempCoupon.id}`),this.$http[o](t,{data:this.tempCoupon}).then(c=>{h.fire({icon:"success",title:`${c.data.message}`}),this.couponsModal.hide(),this.$emit("update")}).catch(c=>{h.fire({icon:"error",title:`${c.response.data.message}`})})},show(){this.couponsModal.show()},hide(){this.couponsModal.hide()}},computed:{minDate(){return new Date().toISOString().substr(0,10)}},watch:{innerTempCoupon(){this.tempCoupon=this.innerTempCoupon;const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");this.due_date=o[0]},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponsModal=new k(this.$refs.couponsModal)}},I={id:"couponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponsModalLabel","aria-hidden":"true",ref:"couponsModal"},N={class:"modal-dialog"},U={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},R={id:"couponsModalLabel",class:"modal-title"},F={key:0},O={key:1},B=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),H={class:"modal-body"},q={class:"row"},G={class:"mb-3 col-12"},z=e("label",{for:"coupon_title",class:"form-label"},"優惠券名稱",-1),X={class:"row"},Y={class:"mb-3 col-12"},j=e("label",{for:"coupon_code",class:"form-label"},"優惠券代碼",-1),J={class:"row"},K={class:"mb-3 col-12"},Q=e("label",{for:"coupon_percent",class:"form-label"},"優惠折扣",-1),W={class:"row"},Z={class:"mb-3 col-12"},ee=e("label",{for:"coupon_endDate",class:"form-label"},"優惠券到期日",-1),te=["min"],oe={class:"form-check"},se={class:"form-check-label",for:"is_enabled"},ne={class:"modal-footer"},ie={type:"submit",class:"btn btn-primary text-light"};function le(o,t,c,V,s,l){const m=u("VField"),_=u("ErrorMessage"),b=u("VForm");return d(),p("div",I,[e("div",N,[e("div",U,[e("div",S,[e("h5",R,[c.isNew?(d(),p("span",F,"新增優惠券")):(d(),p("span",O,"編輯優惠券"))]),B]),a(b,{ref:"form",onSubmit:l.confirm},{default:y(({errors:n})=>[e("div",H,[e("div",q,[e("div",G,[z,a(m,{id:"coupon_title",name:"優惠券名稱",type:"text",class:f(["form-control",{"is-invalid":n.優惠券名稱}]),placeholder:"請輸入優惠券名稱",modelValue:s.tempCoupon.title,"onUpdate:modelValue":t[0]||(t[0]=i=>s.tempCoupon.title=i),rules:"required"},null,8,["class","modelValue"]),a(_,{name:"優惠券名稱",class:"invalid-feedback"})])]),e("div",X,[e("div",Y,[j,a(m,{id:"coupon_code",name:"優惠券代碼",type:"text",class:f(["form-control",{"is-invalid":n.優惠券代碼}]),rules:"required",placeholder:"請輸入優惠券代碼",modelValue:s.tempCoupon.code,"onUpdate:modelValue":t[1]||(t[1]=i=>s.tempCoupon.code=i)},null,8,["class","modelValue"]),a(_,{name:"優惠券代碼",class:"invalid-feedback"})])]),e("div",J,[e("div",K,[Q,a(m,{id:"coupon_percent",name:"優惠折扣",type:"number",class:f(["form-control",{"is-invalid":n.優惠折扣}]),rules:"required|between:1,100",placeholder:"請輸入優惠百分比 (60 = 6折)",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":t[2]||(t[2]=i=>s.tempCoupon.percent=i),modelModifiers:{number:!0},min:"1",max:"100"},null,8,["class","modelValue"]),a(_,{name:"優惠折扣",class:"invalid-feedback"})])]),e("div",W,[e("div",Z,[ee,C(e("input",{id:"coupon_endDate",type:"date",class:"form-control",placeholder:"請選擇優惠券到期日","onUpdate:modelValue":t[3]||(t[3]=i=>s.due_date=i),min:l.minDate},null,8,te),[[T,s.due_date]])])]),e("div",oe,[C(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=i=>s.tempCoupon.is_enabled=i),"true-value":1,"false-value":0},null,512),[[$,s.tempCoupon.is_enabled]]),e("label",se,r(s.tempCoupon.is_enabled?"啟用":"不啟用"),1)])]),e("div",ne,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[5]||(t[5]=(...i)=>l.hide&&l.hide(...i))}," 取消 "),e("button",ie,r(this.isNew?"新增優惠券":"更新優惠券"),1)])]),_:1},8,["onSubmit"])])])],512)}const ae=D(L,[["render",le]]),{VITE_APP_URL:M,VITE_APP_PATH:P}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/iiincookie-vue/",MODE:"production",DEV:!1,PROD:!0},de={data(){return{coupons:[],pagination:{},isNew:!1,tempCoupon:{title:"",is_enabled:1,percent:100,code:""}}},methods:{openModal(o,t){o==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3,is_enabled:1},this.$refs.couponsModal.show(),this.isNew=!0):o==="edit"?(this.$refs.couponsModal.show(),this.tempCoupon={...t},this.isNew=!1):o==="delete"&&(this.$refs.deleteModal.show(),this.tempCoupon={...t},this.isNew=!1)},getCouponList(o=1){this.$http.get(`${M}/api/${P}/admin/coupons/?page=${o}`).then(t=>{this.pagination=t.data.pagination,this.coupons=t.data.coupons}).catch(t=>{h.fire({icon:"error",title:`${t.response.data.message}`})})},formatDate(o){return new Date(o*1e3).toLocaleDateString()},deleteCoupon(){this.$http.delete(`${M}/api/${P}/admin/coupon/${this.tempCoupon.id}`).then(o=>{h.fire({icon:"success",title:`${o.data.message}`}),this.$refs.deleteModal.hide(),this.getCouponList()}).catch(o=>{h.fire({icon:"error",title:`${o.response.data.message}`})})}},mounted(){this.getCouponList()},components:{CouponsModal:ae,DeleteModal:E,PaginationComponent:A}},pe=e("h1",{class:"fs-2xl border-bottom border-secondary pb-2"},"優惠券管理",-1),ce={class:"text-end mt-4"},re={class:"table mt-4"},ue=e("thead",null,[e("tr",null,[e("th",{width:"120"},"優惠券標題"),e("th",{width:"120"},"優惠碼"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"100"},"啟用狀態"),e("th",{width:"120"},"編輯")])],-1),me={key:0,class:"text-success"},_e={key:1},he={class:"btn-group"},be=["onClick"],fe=["onClick"];function Ce(o,t,c,V,s,l){const m=u("PaginationComponent"),_=u("CouponsModal"),b=u("DeleteModal");return d(),p(w,null,[pe,e("div",ce,[e("button",{type:"button",class:"btn btn-primary text-light",onClick:t[0]||(t[0]=n=>l.openModal("new",o.coupon))}," 建立新優惠券 ")]),e("table",re,[ue,e("tbody",null,[(d(!0),p(w,null,x(s.coupons,n=>(d(),p("tr",{key:n.id},[e("td",null,r(n.title),1),e("td",null,r(n.code),1),e("td",null,r(n.percent),1),e("td",null,r(l.formatDate(n.due_date)),1),e("td",null,[n.is_enabled?(d(),p("span",me,"已啟用")):(d(),p("span",_e,"未啟用"))]),e("td",null,[e("div",he,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>l.openModal("edit",n)}," 編輯 ",8,be),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>l.openModal("delete",n)}," 刪除 ",8,fe)])])]))),128))])]),a(m,{"page-in":s.pagination,onGetPages:l.getCouponList},null,8,["page-in","onGetPages"]),a(_,{ref:"couponsModal",innerTempCoupon:s.tempCoupon,isNew:s.isNew,onUpdate:l.getCouponList},null,8,["innerTempCoupon","isNew","onUpdate"]),a(b,{deleteItem:s.tempCoupon,deleteModalTitle:"優惠券",onDelItem:l.deleteCoupon,ref:"deleteModal"},null,8,["deleteItem","onDelItem"])],64)}const Fe=D(de,[["render",Ce]]);export{Fe as default};
